{%- liquid
  assign discount_codes = cart.cart_level_discount_applications | where: 'type', 'discount_code' | map: 'title'
  for item in cart.items
    for allocation in item.line_level_discount_allocations
      if allocation.discount_application.type == 'discount_code'
        assign discount_codes = item.line_level_discount_allocations | slice: forloop.index0 | map: 'discount_application' | map: 'title' | concat: discount_codes
      endif
    endfor
  endfor
  assign discount_codes = discount_codes | uniq
-%}
<cart-discount id="cartDiscount" class="cart__discount db field gap mb{{ blkSt.bm }}" data-id="{{ section_id }}" style="--gap:10px;">
        <form on:submit="/applyDiscount" onsubmit="return false;" class="cart-discount__form">
          <label for="cart-discount" class="fs16 fwm mb5">{{ settings.cpnttl }}</label>
          <div class="ad_input fl mb10">
            <input id="cart-discount" class="fl1 mb0 input w_100 stopEv cart-discount-input" name="discount" placeholder="{{ 'cart.general.discount_code' | t }}">
            <button type="submit" class="btn cart-discount__button">
              <span class="txt">{{ 'cart.button.apply' | t }}</span>
              <div class="loading__spinner hidden">{% render 'icon-loading' %}</div>
            </button>
          </div>
        </form>
        <div class="cart-discount__error fs12 ermsg hidden mb10" role="alert" ref="cartDiscountError"></div>
        <ul class="cart-discount__codes fl f-wrap">
          {% for discount in discount_codes %}
            <li class="discount-code fl f-aic" data-discount-code="{{ discount }}" aria-label="{{ 'cart.general.discount_applied' | t: code: discount }}">
              <span class="mr5">{% render 'icon-tag' %}</span> {{ discount }}
              <button type="button" on:click="/removeDiscount" class="cart-discount-remove btnLink" aria-label="{{ 'cart.general.remove_discount' | t: code: discount }}">
                <svg class="at-icon remove ml10" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="Icon"><path d="m19.75 6c0-.414-.336-.75-.75-.75h-14c-.414 0-.75.336-.75.75v13.5c0 .862.342 1.689.952 2.298.609.61 1.436.952 2.298.952h9c.862 0 1.689-.342 2.298-.952.61-.609.952-1.436.952-2.298 0-4.5 0-13.5 0-13.5zm-1.5.75v12.75c0 .464-.184.909-.513 1.237-.328.329-.773.513-1.237.513-2.542 0-6.458 0-9 0-.464 0-.909-.184-1.237-.513-.329-.328-.513-.773-.513-1.237v-12.75z"></path><path d="m16.5 6.75c.414 0 .75-.336.75-.75 0 0 0-1 0-2 0-.729-.29-1.429-.805-1.945-.516-.515-1.216-.805-1.945-.805-1.488 0-3.512 0-5 0-.729 0-1.429.29-1.945.805-.515.516-.805 1.216-.805 1.945v2c0 .414.336.75.75.75zm-.75-1.5h-7.5v-1.25c0-.332.132-.649.366-.884.235-.234.552-.366.884-.366h5c.332 0 .649.132.884.366.234.235.366.552.366.884z"></path><path d="m20 5.25h-16c-.414 0-.75.336-.75.75s.336.75.75.75h16c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z"></path><path d="m8.75 10.5v7c0 .414.336.75.75.75s.75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75z"></path><path d="m13.75 10.5v7c0 .414.336.75.75.75s.75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75z"></path></g></svg>
                {% render 'icon-loading', class: 'ml10' %}
              </button>
            </li>
          {% endfor %}
        </ul>
</cart-discount>